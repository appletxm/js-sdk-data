!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).HFAgent=t()}(this,function(){"use strict";var n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var e=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e};function o(e,t){var n;if(e&&"function"==typeof e)return(n=e(t))instanceof i?n:new i(n)}var i=function(){function t(e){n(this,t),this.pending=!0,this.fullfilled=!1,this.rejected=!1,this.thenCb=null,this.catchCb=null,this.finalyCb=null,e&&e(this.resolve.bind(this),this.reject.bind(this))}return e(t,[{key:"resolve",value:function(e){this.fullfilled=!0,o(this.thenCb,e),o(this.finalyCb)}},{key:"reject",value:function(e){this.rejected=!0,o(this.catchCb,e),o(this.finalyCb)}},{key:"then",value:function(e){this.thenCb=e}},{key:"catch",value:function(e){this.catchCb=e}},{key:"finaly",value:function(e){this.finalyCb=e}}]),t}();function t(e,t){for(var n in t)e[n]=t[n];return e}function d(e){var t="?timer="+(new Date).getTime()+"&",n=e.params,r=Object.keys(n);if(0<=e.headers.contentType.indexOf("application/json"))t=t+"params="+encodeURIComponent(JSON.stringify(n));else for(var o=0;o<r.length;o++)t+=r[o]+"="+n[key[o]]+(o===r.length-1?"":"&");return t}var a={method:"GET",async:!0,url:"",params:{},timeout:3e4,headers:{contentType:"application/json; charset=UTF-8"}},c={},s=function(){function t(e){n(this,t),this.options=Object.assign(a,e)}return e(t,[{key:"mergeOptions",value:function(e){var t=JSON.parse(JSON.stringify(this.options));return e=Object.assign(t,e)}},{key:"createXHR",value:function(e){var t;return window.ActiveXObject?t=new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest&&(t=new XMLHttpRequest),t.timeout&&(t.timeout=e.timeout),t}},{key:"addEventListener",value:function(r,o,i,t){var a=this,s=c[r].xhr;if(!s)return!1;s.onreadystatechange=function(){var e,t;if(4===s.readyState&&200===s.status){var n=s.getResponseHeader("content-type");0<=n.indexOf("application/octet-stream")||0<=n.indexOf("application/x-msdownload")?function(e){var t=new Blob([e.response],{type:"application/vnd.ms-excel"}),n=e.getResponseHeader("content-disposition").match(/filename=([^;]+)/),r=n&&n[1]?decodeURIComponent(n[1]):"download.excel";if(window.navigator.msSaveOrOpenBlob)return window.navigator.msSaveOrOpenBlob(t,r);var o=URL.createObjectURL(t),i=document.createElement("a"),a=document.querySelector("body");o.indexOf(window.location.host)<0&&(o=o.replace(/^(blob:)(.+)$/,function(e,t,n){return t+(window.location.protocol+"//")+window.location.host+"/"+n})),i.href=o,i.download=r,a.appendChild(i),i.click(),a.removeChild(i)}(s):((t=s.responseText.replace(/^[\s\t\r\n]+|[\s\t\r\n]+$/g,""))&&(e=t&&JSON.parse(s.responseText)),a.destroyed(r),o({code:"200",data:e}))}else 4===s.readyState&&200!==s.status&&(a.destroyed(r),i({code:"500",msg:s.response}))},s.addEventListener&&(s.addEventListener("timeout",function(){a.destroyed(r),i({code:"10000",msg:"request timeout"})}),s.addEventListener("error",function(e){a.destroyed(r),i({code:"500",msg:e})}),t.onProgress&&"function"==typeof t.onProgress&&s.addEventListener("progress",function(e){t.onProgress(e)}))}},{key:"destroyed",value:function(e){c[e]&&delete c[e]}},{key:"prepareForAjax",value:function(e){var t,n,r,o;return e=this.mergeOptions(e),n=Math.random()+"",c[n]={},t=this.createXHR(e),{options:c[n].options=e,xhrId:c[n].xhrId=n,xhrObj:c[n].xhr=t,promise:new Promise(function(e,t){o=t,r=e}),resolveCb:r,rejectCb:o}}},{key:"doAjax",value:function(e,t){t.open(e.method,e.url,e.async),function(e,t){var n=e.headers;for(var r in n){var o;o="contentType"===r?"Content-Type":r,t.setRequestHeader(o,n[r])}}(e,t),t.send(e.paramsStr)}},{key:"get",value:function(e){var t;e.method="GET";var n=this.prepareForAjax(e),r=n.options,o=n.xhrObj,i=n.promise,a=n.resolveCb,s=n.rejectCb,c=n.xhrId;return"GET"===r.method&&o&&(t=d(r)),r.url=r.url+t,this.addEventListener(c,a,s,r),this.doAjax(r,o),i}},{key:"post",value:function(e){e.method="POST";var t=this.prepareForAjax(e),n=t.options,r=t.xhrObj,o=t.promise,i=t.resolveCb,a=t.rejectCb,s=t.xhrId;return"POST"===n.method&&r&&(n.paramsStr=function(e){var t="",n=e.params,r=Object.keys(n);if(0<=e.headers.contentType.indexOf("application/json"))t=JSON.stringify(n);else if(0<=e.headers.contentType.indexOf("application/x-www-form-urlencoded"))for(var o=0;o<r.length;o++)t+=r[o]+"="+encodeURIComponent(n[r[o]])+(o===r.length-1?"":"&");else 0<=e.headers.contentType.indexOf("multipart/form-data")?t="":0<=e.headers.contentType.indexOf("text/xml")&&(t="");return t}(n)),this.addEventListener(s,i,a,n),this.doAjax(n,r),o}},{key:"getBinary",value:function(e){var t;e.method="GET";var n=this.prepareForAjax(e),r=n.options,o=n.xhrObj,i=n.promise,a=n.resolveCb,s=n.rejectCb,c=n.xhrId;return"GET"===r.method&&o&&(t=d(r)),r.url=r.url+t,o.responseType="arraybuffer",this.addEventListener(c,a,s,r),this.doAjax(r,o),i}}]),t}(),u={serviceUrl:"",appKey:""},l={};function p(e,t){var n=JSON.parse(t),r={};for(var o in r.schemeKey=e,n)r[o]=n[o];return r}function f(e){var t=l.ajax;1<arguments.length&&"string"==typeof e&&(e=[p(arguments[0],arguments[1])]),t.post({url:u.serviceUrl,params:e}).then(function(){}).catch(function(e){console.info("hf js sdk onSend:",e)})}return l.init=function(e){u=Object.assign(u,e),function(){var e={method:"POST",url:u.serviceUrl,headers:{contentType:"application/json; charset=UTF-8",appKey:u.appKey}};l.ajax=new s(e)}()},l.onEvent=function(e,t){var n=[];try{n.push(p(e,t)),f(n)}catch(e){console.info("hf js sdk onEvent:",e)}},l.onSend=f,window&&(window.HFAgent=l,window.HFAgent.init({appKey:"${appKey}",serviceUrl:"${serviceUrl}"})),window.Promise||(window.Promise=i),Object.assign||(Object.assign=t),l});
