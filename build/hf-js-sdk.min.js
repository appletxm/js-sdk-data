!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).HFAgent=t()}(this,function(){"use strict";var n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var e=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function r(e,t){var n;if(e&&"function"==typeof e)return(n=e(t))instanceof i?n:new i(n)}var i=function(){function t(e){n(this,t),this.pending=!0,this.fullfilled=!1,this.rejected=!1,this.thenCb=null,this.catchCb=null,this.finalyCb=null,e&&e(this.resolve.bind(this),this.reject.bind(this))}return e(t,[{key:"resolve",value:function(e){this.fullfilled=!0,r(this.thenCb,e),r(this.finalyCb)}},{key:"reject",value:function(e){this.rejected=!0,r(this.catchCb,e),r(this.finalyCb)}},{key:"then",value:function(e){this.thenCb=e}},{key:"catch",value:function(e){this.catchCb=e}},{key:"finaly",value:function(e){this.finalyCb=e}}]),t}();function t(e,t){for(var n in t)e[n]=t[n];return e}function d(e){var t="?timer="+(new Date).getTime()+"&",n=e.params,o=Object.keys(n);if(0<=e.headers.contentType.indexOf("application/json"))t=t+"params="+encodeURIComponent(JSON.stringify(n));else for(var r=0;r<o.length;r++)t+=o[r]+"="+n[key[r]]+(r===o.length-1?"":"&");return t}var a={method:"GET",async:!0,url:"",params:{},timeout:3e4,headers:{contentType:"application/json; charset=UTF-8"}},c={},s=function(){function t(e){n(this,t),this.options=Object.assign(a,e)}return e(t,[{key:"mergeOptions",value:function(e){var t=JSON.parse(JSON.stringify(this.options));return e=Object.assign(t,e)}},{key:"createXHR",value:function(e){var t;return window.ActiveXObject?t=new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest&&(t=new XMLHttpRequest),t.timeout&&(t.timeout=e.timeout),t}},{key:"addEventListener",value:function(o,r,i,t){var a=this,s=c[o].xhr;if(!s)return!1;s.onreadystatechange=function(){var e,t;if(4===s.readyState&&200===s.status){var n=s.getResponseHeader("content-type");0<=n.indexOf("application/octet-stream")||0<=n.indexOf("application/x-msdownload")?function(e){var t=new Blob([e.response],{type:"application/vnd.ms-excel"}),n=e.getResponseHeader("content-disposition").match(/filename=([^;]+)/),o=n&&n[1]?decodeURIComponent(n[1]):"download.excel";if(window.navigator.msSaveOrOpenBlob)return window.navigator.msSaveOrOpenBlob(t,o);var r=URL.createObjectURL(t),i=document.createElement("a"),a=document.querySelector("body");r.indexOf(window.location.host)<0&&(r=r.replace(/^(blob:)(.+)$/,function(e,t,n){return t+(window.location.protocol+"//")+window.location.host+"/"+n})),i.href=r,i.download=o,a.appendChild(i),i.click(),a.removeChild(i)}(s):((t=s.responseText.replace(/^[\s\t\r\n]+|[\s\t\r\n]+$/g,""))&&(e=t&&JSON.parse(s.responseText)),a.destroyed(o),r({code:"200",data:e}))}else 4===s.readyState&&200!==s.status&&(a.destroyed(o),i({code:"500",msg:s.response}))},s.addEventListener&&(s.addEventListener("timeout",function(){a.destroyed(o),i({code:"10000",msg:"request timeout"})}),s.addEventListener("error",function(e){a.destroyed(o),i({code:"500",msg:e})}),t.onProgress&&"function"==typeof t.onProgress&&s.addEventListener("progress",function(e){t.onProgress(e)}))}},{key:"destroyed",value:function(e){c[e]&&delete c[e]}},{key:"prepareForAjax",value:function(e){var t,n,o,r;return e=this.mergeOptions(e),n=Math.random()+"",c[n]={},t=this.createXHR(e),{options:c[n].options=e,xhrId:c[n].xhrId=n,xhrObj:c[n].xhr=t,promise:new Promise(function(e,t){r=t,o=e}),resolveCb:o,rejectCb:r}}},{key:"doAjax",value:function(e,t){t.open(e.method,e.url,e.async),function(e,t){var n=e.headers;for(var o in n){var r;r="contentType"===o?"Content-Type":o,t.setRequestHeader(r,n[o])}}(e,t),t.send(e.paramsStr)}},{key:"get",value:function(e){var t;e.method="GET";var n=this.prepareForAjax(e),o=n.options,r=n.xhrObj,i=n.promise,a=n.resolveCb,s=n.rejectCb,c=n.xhrId;return"GET"===o.method&&r&&(t=d(o)),o.url=o.url+t,this.addEventListener(c,a,s,o),this.doAjax(o,r),i}},{key:"post",value:function(e){e.method="POST";var t=this.prepareForAjax(e),n=t.options,o=t.xhrObj,r=t.promise,i=t.resolveCb,a=t.rejectCb,s=t.xhrId;return"POST"===n.method&&o&&(n.paramsStr=function(e){var t="",n=e.params,o=Object.keys(n);if(0<=e.headers.contentType.indexOf("application/json"))t=JSON.stringify(n);else if(0<=e.headers.contentType.indexOf("application/x-www-form-urlencoded"))for(var r=0;r<o.length;r++)t+=o[r]+"="+encodeURIComponent(n[o[r]])+(r===o.length-1?"":"&");else 0<=e.headers.contentType.indexOf("multipart/form-data")?t="":0<=e.headers.contentType.indexOf("text/xml")&&(t="");return t}(n)),this.addEventListener(s,i,a,n),this.doAjax(n,o),r}},{key:"getBinary",value:function(e){var t;e.method="GET";var n=this.prepareForAjax(e),o=n.options,r=n.xhrObj,i=n.promise,a=n.resolveCb,s=n.rejectCb,c=n.xhrId;return"GET"===o.method&&r&&(t=d(o)),o.url=o.url+t,r.responseType="arraybuffer",this.addEventListener(c,a,s,o),this.doAjax(o,r),i}}]),t}(),u={serviceUrl:"http://192.168.10.125:18080/web",appKey:"7ab928574cf24c0fa6cf55c8cfec26c1"},f={};function l(e,t){var n=JSON.parse(t),o={};for(var r in o.schemeKey=e,n)o[r]=n[r];return o}function p(e){var t=f.ajax;1<arguments.length&&"string"==typeof e&&(e=[l(arguments[0],arguments[1])]),t.post({url:u.serviceUrl,params:e}).then(function(){}).catch(function(e){console.info("hf js sdk onSend:",e)})}return f.init=function(e){u=Object.assign(u,e),function(){var e={method:"POST",url:u.serviceUrl,headers:{contentType:"application/json; charset=UTF-8",appKey:u.appKey}};f.ajax=new s(e)}()},f.onEvent=function(e,t){var n=[];try{n.push(l(e,t)),p(n)}catch(e){console.info("hf js sdk onEvent:",e)}},f.onSend=p,window&&(window.HFAgent=f),window.Promise||(window.Promise=i),Object.assign||(Object.assign=t),f});
